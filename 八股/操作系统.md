# 进程管理

## 1.进程与线程区别
- 一个进程可以包含多个线程
- 进程间不共享资源，有独立代码和数据空间（程序上下文），由系统直接分发，__开销大__ ,统一进程的不同线程共享空间，线程只独立拥有 __程序计数器、寄存器、堆栈、状态__

- 1.__拥有资源__:进程是资源分配的基本单元，线程是cpu分配和调度的基本单元  
  进程在执行过程中拥有独立的内存单元，而多个线程共享进程的内存。（资源分配给进程，同一进程的所有线程共享该进程的所有资源。同一进程中的多个线程共享代码段（代码和常量），数据段（全局变量和静态变量），扩展段（堆存储）。但是每个线程拥有自己的栈段，栈段又叫运行时段，用来存放所有局部变量和临时变量。
- 2.__调度__：线程是实现独立调度的基本单位。在同一进程中，线程的切换不会引起进程切换，从一个进程中的线程切换到另一个进程中的线程时，会引起进程切换。
- 3.__系统开销__：由于创建和撤销进程时，系统都要位置分配或回收资源，如内存空间、I/O设备等，所付出的开销远大于创建或撤销线程时的开销。类似的，在进行进程切换时，涉及当前执行进程CPU环境的保存及新调度进程CPU环境的设置，而线程切换时之所需保存和设置少量寄存器内容，开销很小
-  4.__通信__：线程间可以通过直接读写同一进程中的数据进行通信，但是进程通信需要借助IPC

## 2.讲讲自旋锁、递归锁、乐观锁、悲观锁、公平锁、非公平锁
- 自旋锁：spinlock，在任何时刻同样只能有一个线程访问对象，但是当获取锁操作失败时，不会进入睡眠，而是会在原地自旋，直到锁被释放。这样节省了线程从睡眠状态到被唤醒期间的消耗，在加锁时间短暂的环境下会极大的提高效率。但如果加锁时间过长，则会非常浪费CPU资源。

## 3.进程间的通信方式
进程通信的方式主要有6种：管道，信号量，消息队列，信号，共享内存，套接字
- 管道
  - 管道是半双工的（单向）双方需要通信的时候，需要建立两个管道。管道的实质是一个内核缓冲区，进程以先进先出的方式从缓冲区存取数据：管道一端的进程顺序地将进程数据写入缓冲区，另一端的进程则顺序地读取数据，该缓冲区可以看做一个循环队列，读和写的位置都是自动增加的，一个数据只能被读一次，读出以后再缓冲区都不复存在了。当缓冲区读空或者写满时，有一定的规则控制相应的读进程或写进程是否进入等待队列，当空的缓冲区有新数据写入或慢的缓冲区有数据读出时，就唤醒等待队列中的进程继续读写。管道是最容易实现的

  - 名管道pipe和命名管道除了建立，打开，删除的方式不同外，其余都是一样的。匿名管道只允许有亲缘关系的进程之间通信，也就是父子进程之间的通信，命名管道允许具有非亲缘关系的进程间通信。

- 信号量
  - 信号量是一个 __计数器__，可以用来控制多个进程对共享资源的访问，信号量只有等待和发送两种操作。等待（P(sv)）就是将其值减一或者挂起进程，发送（V(sv)）就是将其值加一，或者将进程恢复运行

- 信号
  - 信号是Linux系统中用于进程之间通信或操作的一种机制，信号可以在任何时候发送给某一进程，而无须知道该进程的状态，如果该进程并未处于执行状态，则该信号就由内核保存起来，直到该进程恢复执行并传递给他为止，果一个信号被进程设置为阻塞，则该信号的传递被延迟，直到其阻塞被取消时才被传递给进程。 信号是 __开销最小__ 的。

- 共享内存
  - 共享内存允许两个或多个进程共享一个给定的存储区，这一段存储区可以被两个或两个以上的进程映射至自身的地址空间中，就像由malloc()分配的内存一样使用。一个进程写入共享内存的信息，可以被其他使用这个共享内存的进程，通过一个简单的内存读取读出，从而实现了进程间的通信。共享内存的 __效率最高__，__缺点__ 是没有提供同步机制，需要使用锁等其他机制进行同步。

- 消息队列
  - 消息队列就是一个消息的链表，是一系列保存在内核中消息的列表。用户进程可以向消息队列添加消息，也可以向消息队列读取消息
  - 消息队列与管道通信相比，其优势是对每个消息指定特定的消息类型，接收的时候不需要按照队列次序，而是可以根据自定义条件接收特定类型的消息
  - 可以把消息看做一个记录，具有特定的格式以及特定的优先级。对消息队列有写权限的进程可以向消息队列中按照一定的规则添加新消息面对消息队列有读权限的进程可以从消息队列中读取消息
  - 可以在不同的进程之间特工全双工的通信连接

- 套接字
  - 其特点在于可用于不同机器之间的进程通信。


